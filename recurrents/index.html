<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Recurrent layers - NNSharp Documentation</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Recurrent layers";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> NNSharp Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../install/">Installation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../models/">Models</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../data/">Data structure</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Keras</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../startkeras/">Quick start</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../core/">Core</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../convolutions/">Convolutions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../pooling/">Pooling</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../activations/">Activations</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Recurrent layers</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#simplernn">SimpleRNN</a></li>
                
            
                <li class="toctree-l3"><a href="#lstm">LSTM</a></li>
                
            
                <li class="toctree-l3"><a href="#gru">GRU</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../batchnormalization/">BatchNormalization</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>TensorFlow</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../starttensorflow/">Quick start</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">NNSharp Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Keras &raquo;</li>
        
      
    
    <li>Recurrent layers</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/adamtiger/NNSharp" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>The main idea behind a recurrent neural network (RNN) is to grab the relations in a process where the input is a time-sequence with consequtive data pieces. Therefore the order of the pieces is strict. The relation connects to the time. An examplary problem can be when a software tries to predict the next data piece by knowing the previous 5 pieces. </p>
<p>Generally the input of an rnn is a set of vectors (e.g.: a vector for each time point) and the output is also a set of vector but may be it has different size then the input. Each vector is processed by a cell (only one type of cell is applied) but in a strict order and with some delay. Therefore as the computation goes each cell processes a vector, gives (or not) an output and calculates some further state values which will be fed into the next cell. The next cell receives the state values and the next input vector from the sequence, executes the calculations and so on. </p>
<p>Shortly, an RNN is a finite long sequence of cells. Each cell has the same structure. The input vectors processed consequtively and some hidden variables are computed and forwarded as well. Some references for further insight:</p>
<p><a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">The Unreasonable Effectiveness of Recurrent Neural Networks</a><br>
<a href="https://deeplearning4j.org/lstm#a-beginners-guide-to-recurrent-networks-and-lstms">A Beginnerâ€™s Guide to Recurrent Networks and LSTMs</a><br>
<a href="http://www.wildml.com/2015/09/recurrent-neural-networks-tutorial-part-1-introduction-to-rnns/">Recurrent Neural Networks Tutorial on WILDML</a>.</p>
<p><span style="float:right;"><a href="https://github.com/adamtiger/NNSharp/blob/master/NNSharp/Kernels/CPUKernels/SimpleRNNKernel.cs#L12">[source]</a></span></p>
<h2 id="simplernn">SimpleRNN</h2>
<p>The structure of the so called simple RNN layer in Keras is the following:</p>
<p><img alt="simplernn" src="https://drive.google.com/uc?export=download&amp;id=0B97L9zqg-lnwUXZjSUVOUjBJZEE" /></p>
<p>The <strong>h</strong> is the hidden variable, <strong>R</strong> is the recurrent kernel, <strong>W</strong> is the kernel, <strong>b</strong> is the bias and <strong>f</strong> is the activation function. </p>
<p><strong>Input:</strong></p>
<p>A Data2D type with the shape: (1, timesteps, input dimension, batches).</p>
<p><strong>Output:</strong></p>
<p>A Data2D type with shape: (1, 1, units, batches). </p>
<p><strong>Methods:</strong></p>
<p>The SimpleRNN cell implements the operations shown in the picture and feeds the output to the next cell. The unrolled cells are implemented by a <em>for</em> cycle. It can be useful to inspect the <a href="https://github.com/fchollet/keras/blob/master/keras/layers/recurrent.py#L555">Keras implementation</a> as well.</p>
<p><span style="float:right;"><a href="https://github.com/adamtiger/NNSharp/blob/master/NNSharp/Kernels/CPUKernels/LSTMKernel.cs#L11">[source]</a></span></p>
<h2 id="lstm">LSTM</h2>
<p>The structure of the LSTM cell is the following:</p>
<p><img alt="lstm" src="https://drive.google.com/uc?export=download&amp;id=0B97L9zqg-lnwMFZWRFJrSXFtd28" /></p>
<p>The <strong>g</strong> is the recurrent activation, <strong>p</strong> is the activation, <strong>W</strong>s are the kernels, <strong>U</strong>s are the recurrent kernels, <strong>h</strong> is the hidden variable which is the output too and the notation * is an element-wise multiplication.</p>
<p><strong>Input:</strong></p>
<p>A Data2D type with the shape: (1, timesteps, input dimension, batches).</p>
<p><strong>Output:</strong></p>
<p>A Data2D type with shape: (1, 1, units, batches).</p>
<p><strong>Methods:</strong></p>
<p>The Keras implementation can help as well: <a href="https://github.com/fchollet/keras/blob/master/keras/layers/recurrent.py#L1123">see</a> the step function in the LSTM implementation. Basically the products are dot products between matricies.</p>
<p><span style="float:right;"><a href="https://github.com/adamtiger/NNSharp/blob/master/NNSharp/Kernels/CPUKernels/GRUKernel.cs#L11">[source]</a></span></p>
<h2 id="gru">GRU</h2>
<p>The structure of the GRU cell is the following:</p>
<p><img alt="gru" src="https://drive.google.com/uc?export=download&amp;id=0B97L9zqg-lnwcU4tVVVQS0d3VmM" /></p>
<p>The meaning of the notations are the same as in case of LSTM. 1-z means an element-wise subtraction. </p>
<p><strong>Input:</strong></p>
<p>A Data2D type with the shape: (1, timesteps, input dimension, batches).</p>
<p><strong>Output:</strong></p>
<p>A Data2D type with shape: (1, 1, units, batches).</p>
<p><strong>Methods:</strong></p>
<p>The Keras implementation can help as well: <a href="https://github.com/fchollet/keras/blob/master/keras/layers/recurrent.py#L828">see</a> the step function in the LSTM implementation. <a href="http://www.wildml.com/2015/10/recurrent-neural-network-tutorial-part-4-implementing-a-grulstm-rnn-with-python-and-theano/">This</a> blog article can be useful as well.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../batchnormalization/" class="btn btn-neutral float-right" title="BatchNormalization"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../activations/" class="btn btn-neutral" title="Activations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../activations/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../batchnormalization/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
